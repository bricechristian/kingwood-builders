---
import { useSanityClient } from "astro-sanity";
import { urlForImage } from "../../utilities/sanityImage.js";

import Layout from "../../layouts/Layout.astro";
import FeaturedProjects from "../../components/FeaturedProjects.astro"

let previewResponse = await fetch(
    `https://kingwood-builders.netlify.app/.netlify/functions/preview?type=page&slug=${Astro.params.slug}`
);
let responseJSON = await previewResponse.json();


export async function getStaticPaths() {
	const data = await useSanityClient().fetch(`
    *[_type=='page'] {
      ...
    }
  `);
	let paths = [];
	data.map(({ slug }) => paths.push({ params: { slug: slug.current } }));

	return paths;
}

const { slug } = Astro.params;

const data = responseJSON.data;

if (!data) return Astro.redirect("/404");
// console.log(data)

---

<Layout
	noindex={true}
	title={data.title}
>
	{
		data.content?.map((section) => {
			switch (section._type) {
				case "projectCarousel":
                    return (
                        <FeaturedProjects projects={section.projects} /> 
                    )
				case "textHeadline":
                    return (
                        <section class="py-40">
                            <div class="grid-layout text-center">
                                <div class="grid-span-xl">
                                    <h1
                                        class="justify-center"
                                        data-viewport="typography-shift">
                                        <span>{section.title}</span>
                                    </h1>
                                </div>
                            </div>
                        </section>
                    )
				default:
                    return (
                        <section class="py-40">
                            <div class="grid-layout text-center">
                                <div class="grid-span-xl">
                                    <h1
                                        class="justify-center"
                                        data-viewport="typography-shift">
                                        <span>{data.title}</span>
                                    </h1>
                                </div>
                            </div>
                        </section>
                    )
			}
		})
	}
</Layout>
